var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.LoggerUtils=function(){"use strict";function e(e,n){var r=null;if(e.event){if(r=e,r.file_url&&(r.file_format=e.file_format||i(r.file_url)),r.company_id=d,r.display_id=f,location.href){var s=o("parent",location.href),a=o("type",location.href),l=a?a:s?o("type",s):"",u=s?o("id",s):"";"sharedschedule"===l&&(r.presentation_type=l,r.schedule_id=u,r.unique_id=t())}g&&(r.version=g),n(r)}else n(r)}function t(){var e=window.localStorage.uniqueId||"";return""===e&&(e=n(),window.localStorage.setItem("uniqueId",e)),e}function n(){var e=(new Date).getTime(),t=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var o=16*Math.random();return e>0?(o=(e+o)%16|0,e=Math.floor(e/16)):(o=(t+o)%16|0,t=Math.floor(t/16)),("x"===n?o:3&o|8).toString(16)})}function o(e,t){t||(t=window.location.href),e=e.replace(/[[]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),o=n.exec(t);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}function r(){var e=new Date,t=e.getUTCFullYear(),n=e.getUTCMonth()+1,o=e.getUTCDate();return 10>n&&(n="0"+n),10>o&&(o="0"+o),""+t+n+o}function i(e){var t,n=/[?#&]/;return e&&"string"==typeof e?(t=e.substr(e.lastIndexOf(".")+1),n.test(t)&&(t=t.substr(0,-1!==t.indexOf("?")?t.indexOf("?"):t.length),t=t.substr(0,-1!==t.indexOf("#")?t.indexOf("#"):t.length),t=t.substr(0,-1!==t.indexOf("&")?t.indexOf("&"):t.length)),t.toLowerCase()):null}function s(e){var t={kind:"bigquery#tableDataInsertAllRequest",skipInvalidRows:!1,ignoreUnknownValues:!1,templateSuffix:r(),rows:[{insertId:""}]},n=JSON.parse(JSON.stringify(t));return n.rows[0].insertId=Math.random().toString(36).substr(2).toUpperCase(),n.rows[0].json=JSON.parse(JSON.stringify(e)),n.rows[0].json.ts=(new Date).toISOString(),n}function a(t,n){e(n,function(e){null!==e&&RiseVision.Common.Logger.log(t,e)})}function l(e,t){try{top.postToPlayer({message:"widget-log",table:e,params:JSON.stringify(t),suffix:r()})}catch(n){console.log("widget-common.logEventToPlayer",n)}}function u(e,t){d=e,f=t}function c(e){g=e}var f="",d="",g=null;return{getInsertData:s,getFileFormat:i,logEvent:a,logEventToPlayer:l,setIds:u,setVersion:c}}(),RiseVision.Common.Logger=function(e){"use strict";function t(e){var t=new XMLHttpRequest;return new Date-u<358e4?e({}):(t.open("POST",r,!0),t.onloadend=function(){var n={};try{n=JSON.parse(t.response)}catch(o){console.warn("Can't refresh logger token - ",o.message)}e({token:n.access_token,refreshedAt:new Date})},t.send(),void 0)}function n(e){return s&&l===e}function o(o,r){function f(t){var n,s,a=new XMLHttpRequest;s=i.replace("TABLE_ID",o),u=t.refreshedAt||u,c=t.token||c,n=e.getInsertData(r),a.open("POST",s,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization","Bearer "+c),r.cb&&"function"==typeof r.cb&&(a.onloadend=function(){r.cb(a.response)}),a.send(JSON.stringify(n))}if(!(!o||!r||r.hasOwnProperty("event")&&!r.event||r.hasOwnProperty("event")&&n(r.event))&&(r.presentation_type&&"sharedschedule"===r.presentation_type||r.display_id&&"preview"!==r.display_id&&"display_id"!==r.display_id&&"displayId"!==r.display_id)){try{if(top.postToPlayer&&top.enableWidgetLogging)return e.logEventToPlayer(o,r)}catch(d){console.log("widget-common: logger",d)}return s=!0,l=r.event,setTimeout(function(){s=!1},a),t(f)}}var r="https://www.googleapis.com/oauth2/v3/token?client_id="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_ID+"&client_secret="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_SECRET+"&refresh_token="+WIDGET_COMMON_CONFIG.LOGGER_REFRESH_TOKEN+"&grant_type=refresh_token",i="https://www.googleapis.com/bigquery/v2/projects/client-side-events/datasets/Widget_Events/tables/TABLE_ID/insertAll",s=!1,a=1e3,l="",u=0,c="";return{log:o}}(RiseVision.Common.LoggerUtils);