var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.LoggerUtils=function(){"use strict";function e(e){var t=JSON.parse(JSON.stringify(n));return t.rows[0].insertId=Math.random().toString(36).substr(2).toUpperCase(),t.rows[0].json.widget=e.widget,t.rows[0].json.event=e.event,t.rows[0].json.display_id=e.displayId,t.rows[0].json.ts=(new Date).toISOString(),e.eventDetails&&(t.rows[0].json.event_details=e.eventDetails),t}function t(e){var t=new Date,n=t.getUTCFullYear(),s=t.getUTCMonth()+1,o=t.getUTCDate();return 10>s&&(s="0"+s),10>o&&(o="0"+o),e+n+s+o}var n={kind:"bigquery#tableDataInsertAllRequest",skipInvalidRows:!1,ignoreUnknownValues:!1,rows:[{insertId:"",json:{widget:"",event:"",display_id:"",event_details:"",ts:0}}]};return{getInsertData:e,getTable:t}}(),RiseVision.Common.Logger=function(e){"use strict";function t(e){var t=new XMLHttpRequest;return new Date-i<358e4?e({}):(t.open("POST",s,!0),t.onloadend=function(){var n=JSON.parse(t.response);e({token:n.access_token,refreshedAt:new Date})},t.send(),void 0)}function n(n){function s(t){var s,a,d=new XMLHttpRequest;a=o.replace("TABLE_ID",e.getTable("events")),i=t.refreshedAt||i,r=t.token||r,s=e.getInsertData(n),d.open("POST",a,!0),d.setRequestHeader("Content-Type","application/json"),d.setRequestHeader("Authorization","Bearer "+r),n.cb&&"function"==typeof n.cb&&(d.onloadend=function(){n.cb(d.response)}),d.send(JSON.stringify(s))}if(n.widget&&n.event)return t(s)}var s="https://www.googleapis.com/oauth2/v3/token?client_id="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_ID+"&client_secret="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_SECRET+"&refresh_token="+WIDGET_COMMON_CONFIG.LOGGER_REFRESH_TOKEN+"&grant_type=refresh_token",o="https://www.googleapis.com/bigquery/v2/projects/client-side-events/datasets/Widget_Events/tables/TABLE_ID/insertAll",i=0,r="";return{log:n}}(RiseVision.Common.LoggerUtils);