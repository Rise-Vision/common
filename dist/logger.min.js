var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.LoggerUtils=function(){"use strict";function e(e,t){var r=null;if(e.event){r=e,r.file_url&&(r.file_format=e.file_format||n(r.file_url)),r.company_id=g,r.display_id=l;var i=d.getQueryParameter("parent"),o=d.getQueryParameter("type"),s=d.getQueryParameter("env"),a=d.getQueryParameter("viewerId"),p=o?o:i?d.getQueryStringParameter("type",i):"",c=s?s:i?d.getQueryStringParameter("env",i):"",f=a?a:i?d.getQueryStringParameter("viewerId",i):"",y=i?d.getQueryStringParameter("id",i):"";r.viewer_id=f,"sharedschedule"===p&&(r.presentation_type=p,r.schedule_id=y,r.endpoint_type=c),u&&(r.version=u),t(r)}else t(r)}function t(){var e=new Date,t=e.getUTCFullYear(),n=e.getUTCMonth()+1,r=e.getUTCDate();return 10>n&&(n="0"+n),10>r&&(r="0"+r),""+t+n+r}function n(e){var t,n=/[?#&]/;return e&&"string"==typeof e?(t=e.substr(e.lastIndexOf(".")+1),n.test(t)&&(t=t.substr(0,-1!==t.indexOf("?")?t.indexOf("?"):t.length),t=t.substr(0,-1!==t.indexOf("#")?t.indexOf("#"):t.length),t=t.substr(0,-1!==t.indexOf("&")?t.indexOf("&"):t.length)),t.toLowerCase()):null}function r(e){var n={kind:"bigquery#tableDataInsertAllRequest",skipInvalidRows:!1,ignoreUnknownValues:!1,templateSuffix:t(),rows:[{insertId:""}]},r=JSON.parse(JSON.stringify(n));return r.rows[0].insertId=Math.random().toString(36).substr(2).toUpperCase(),r.rows[0].json=JSON.parse(JSON.stringify(e)),r.rows[0].json.ts=(new Date).toISOString(),r}function i(t,n){e(n,function(e){null!==e&&RiseVision.Common.Logger.log(t,e)})}function o(e,n){try{top.postToPlayer({message:"widget-log",table:e,params:JSON.stringify(n),suffix:t()})}catch(r){console.log("widget-common.logEventToPlayer",r)}}function s(e,t){g=e,l=t}function a(e){u=e}var l="",g="",u=null,d=RiseVision.Common.Utilities;return{getInsertData:r,getFileFormat:n,logEvent:i,logEventToPlayer:o,setIds:s,setVersion:a}}(),RiseVision.Common.Logger=function(e){"use strict";function t(e){var t=new XMLHttpRequest;return new Date-g<358e4?e({}):(t.open("POST",i,!0),t.onloadend=function(){var n={};try{n=JSON.parse(t.response)}catch(r){console.warn("Can't refresh logger token - ",r.message)}e({token:n.access_token,refreshedAt:new Date})},t.send(),void 0)}function n(e){return s&&l===e}function r(r,i){function d(t){var n,s,a=new XMLHttpRequest;s=o.replace("TABLE_ID",r),g=t.refreshedAt||g,u=t.token||u,n=e.getInsertData(i),a.open("POST",s,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization","Bearer "+u),i.cb&&"function"==typeof i.cb&&(a.onloadend=function(){i.cb(a.response)}),a.send(JSON.stringify(n))}if(!(!r||!i||i.hasOwnProperty("event")&&!i.event||i.hasOwnProperty("event")&&n(i.event))&&(i.presentation_type&&"sharedschedule"===i.presentation_type||i.display_id&&"preview"!==i.display_id&&"display_id"!==i.display_id&&"displayId"!==i.display_id)){try{if(top.postToPlayer&&top.enableWidgetLogging)return e.logEventToPlayer(r,i)}catch(p){console.log("widget-common: logger",p)}return s=!0,l=i.event,setTimeout(function(){s=!1},a),t(d)}}var i="https://www.googleapis.com/oauth2/v3/token?client_id="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_ID+"&client_secret="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_SECRET+"&refresh_token="+WIDGET_COMMON_CONFIG.LOGGER_REFRESH_TOKEN+"&grant_type=refresh_token",o="https://www.googleapis.com/bigquery/v2/projects/client-side-events/datasets/Widget_Events/tables/TABLE_ID/insertAll",s=!1,a=1e3,l="",g=0,u="";return{log:r}}(RiseVision.Common.LoggerUtils);