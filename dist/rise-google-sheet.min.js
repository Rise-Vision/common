var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.RiseGoogleSheet=function(e,n,t){"use strict";function i(){var n={};return n.key=e.apikey,n.majorDimension=e.dimension,n.valueRenderOption=e.render,n}function o(){return""===e.range?"":"!"+e.range}function s(){return R+e.key+"/values/"+encodeURIComponent(e.sheet)+o()}function r(e){var n=0;return e.forEach(function(e){e.length>n&&(n=e.length)}),n}function a(e){var n,t=0,i=r(e);e.forEach(function(e){if(e.length<i)for(t=i-e.length,n=0;t>n;n++)e.push("")})}function u(e){var n={};return n.results=e.values?e.values:[],a(n.results),n}function c(){var n=parseInt(e.refresh,10);isNaN(n)||0===n||(g(),C=setTimeout(function(){y=!0,d()},6e4*n))}function f(e){var i={status:e.status,statusText:e.statusText};n.getItem(v(),function(e){i=e?Object.assign(i,e.data):i,t("error",i)}),k=!1,c()}function m(e){var i,o={};e&&(i=u(e),o.data=i,o.timestamp=Date.now(),n.saveItem(v(),o),t("response",i)),k=!1,c()}function l(){var e=s(),n=i();k=!0,$.getJSON(e,n).done(function(e){m(e)}).fail(function(e){f(e)})}function v(){return I+"_"+e.key+"_"+encodeURIComponent(e.sheet.replace(/\s+/g,"_"))+(""===e.range?"":"_"+e.range)}function g(){clearTimeout(C),C=null}function h(n){var i,o,s,r,a=parseInt(e.refresh,10);if(y||!n)y=!1,l();else{if(T&&(T=!1,!isNaN(a)&&0!==a)){if(i=n.timestamp,isNaN(i)&&(o=new Date(n.timestamp),i=o.getTime()),s=Date.now(),r=Math.ceil((s-i)/1e3/60),r>=a)return l(),void 0;g(),C=setTimeout(function(){l()},6e4*(a-r))}t("response",n.data)}}function p(){N=!0,n.getItem(v(),function(e){h(e)})}function d(){return e.key&&e.apikey&&""!==e.sheet&&!k?N?(n.getItem(v(),function(e){h(e)}),void 0):n.init(p):void 0}var R="https://sheets.googleapis.com/v4/spreadsheets/",I="risesheet",N=!1,k=!1,y=!1,T=!0,C=null;return{go:d}};