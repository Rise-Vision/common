var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.RiseGoogleSheet=function(e,n,t){"use strict";function o(){var n={};return n.key=e.apikey,n.majorDimension=e.dimension,n.valueRenderOption=e.render,n}function i(){return""===e.range?"":"!"+e.range}function s(){return I+e.key+"/values/"+encodeURIComponent(e.sheet)+i()}function r(e){var n=0;return e.forEach(function(e){e.length>n&&(n=e.length)}),n}function a(e){var n,t=0,o=r(e);e.forEach(function(e){if(e.length<o)for(t=o-e.length,n=0;t>n;n++)e.push("")})}function u(e){var n={};return n.results=e.values?e.values:[],a(n.results),n}function c(){var n=parseInt(e.refresh,10);isNaN(n)||0===n||(v(),M=setTimeout(function(){y=!0,R()},6e4*n))}function f(e){var o={status:e.status,statusText:e.statusText};n.getItem(g(),function(e){o=e?Object.assign(o,e.data):o,t("error",o)}),k=!1,c()}function m(e){var o,i={};e&&(o=u(e),i.data=o,i.timestamp=Date.now(),n.saveItem(g(),i),t("response",o)),k=!1,c()}function l(e,n){return e=Math.ceil(e),n=Math.floor(n),Math.floor(Math.random()*(n-e)+e)}function h(e){var n=s(),t=o(),i=1e3*l(0,e);k=!0,setTimeout(function(){$.getJSON(n,t).done(function(e){m(e)}).fail(function(e){f(e)})},i)}function g(){return N+"_"+e.key+"_"+encodeURIComponent(e.sheet.replace(/\s+/g,"_"))+(""===e.range?"":"_"+e.range)}function v(){clearTimeout(M),M=null}function p(n){var o,i,s,r,a=parseInt(e.refresh,10);y||!n?(y=!1,h(n?180:60)):(t("response",n.data),C&&(C=!1,isNaN(a)||0===a||(o=n.timestamp,isNaN(o)&&(i=new Date(n.timestamp),o=i.getTime()),s=Date.now(),r=Math.ceil((s-o)/1e3/60),r>=a?h(180):(v(),M=setTimeout(function(){h(180)},6e4*(a-r))))))}function d(){T=!0,n.getItem(g(),function(e){p(e)})}function R(){return e.key&&e.apikey&&""!==e.sheet&&!k?T?(n.getItem(g(),function(e){p(e)}),void 0):n.init(d):void 0}var I="https://sheets.googleapis.com/v4/spreadsheets/",N="risesheet",T=!1,k=!1,y=!1,C=!0,M=null;return{go:R}};