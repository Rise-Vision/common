var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.RiseGoogleSheet=function(e,n){"use strict";function t(){var n={};return n.key=e.apikey,n.majorDimension=e.dimension,n.valueRenderOption=e.render,n}function i(){return""===e.range?"":"!"+e.range}function o(){return v+e.key+"/values/"+encodeURIComponent(e.sheet)+i()}function s(e){var n=0;return e.forEach(function(e){e.length>n&&(n=e.length)}),n}function r(e){var n,t=0,i=s(e);e.forEach(function(e){if(e.length<i)for(t=i-e.length,n=0;t>n;n++)e.push("")})}function a(e){var n={};return n.results=e.values?e.values:[],r(n.results),n}function u(){var n=parseInt(e.refresh,10);isNaN(n)||0===n||setTimeout(function(){I=!0,h()},6e4*n)}function f(e){var t={status:e.status};d.getItem(p(),function(e){t=e?Object.assign(t,e.data):t,n("error",t)}),y=!1,u()}function c(e){var t,i={};e&&(t=a(e),i.data=t,i.timestamp=moment().format(),d.saveItem(p(),i),n("response",t)),y=!1,u()}function m(){var e=o(),n=t();y=!0,$.getJSON(e,n).done(function(e){c(e)}).fail(function(e){f(e)})}function p(){return l+"_"+e.key+"_"+encodeURIComponent(e.sheet.replace(/\s+/g,"_"))+(""===e.range?"":"_"+e.range)}function g(t){var i,o,s,r=parseInt(e.refresh,10);if(I||!t)I=!1,m();else{if(k&&(k=!1,!isNaN(r)&&0!==r)){if(i=moment(t.timestamp),o=moment(),s=o.diff(i,"minutes"),s>=r)return m(),void 0;setTimeout(function(){m()},6e4*(r-s))}n("response",t.data)}}function h(){e.key&&e.apikey&&""!==e.sheet&&!y&&(R||d.init(function(){R=!0,d.getItem(p(),function(e){g(e)})}))}var v="https://sheets.googleapis.com/v4/spreadsheets/",l="risesheet",d=new RiseVision.Common.RiseData({endpoint:"spreadsheets",storageType:"local"}),R=!1,y=!1,I=!1,k=!0;return{go:h}};