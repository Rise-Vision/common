<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Background e2e Test</title>

    <script src="/components/webcomponentsjs/webcomponents.min.js"></script>
    <link rel="import" href="/components/rise-storage/rise-storage.html">

    <link rel="stylesheet" type="text/css" href="/src/css/background.css">

</head>
<body>

<rise-storage id="backgroundStorage" refresh="15"></rise-storage>

<div id="background"></div>
<script src="/node_modules/sinon/pkg/sinon.js"></script>
<script src="/node_modules/sinon/pkg/sinon-server-1.12.2.js"></script>
<script src="/node_modules/sinon/pkg/sinon-timers-1.12.2.js"></script>
<script src="/node_modules/widget-tester/mocks/rise-storage-mock.js"></script>
<script src="/test/data/background-storage.js"></script>
<script src="/node_modules/widget-tester/mocks/gadget-mocks.js"></script>
<script src="/src/config/config.js"></script>
<script src="/src/js/background.js"></script>

<script type="text/javascript">
    var prefs = new gadgets.Prefs(),
            id = prefs.getString("id"),
            params = {};

    function additionalParams(names, values) {
        params = JSON.parse(values[0]);

        // Creating background instance
        var background = new RiseVision.Common.Background(params);
        background.init();
    }

    window.addEventListener("WebComponentsReady", function() {
        if (id && id !== "") {
            gadgets.rpc.register("rsparam_set_" + id, additionalParams);
            gadgets.rpc.call("", "rsparam_get", null, id, ["additionalParams"]);
        }
    });

</script>

</body>
</html>
